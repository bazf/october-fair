<!doctype html>
<html lang="uk">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è ‚Äî –ë–ª–∞–≥–æ–¥—ñ–π–Ω–∏–π —è—Ä–º–∞—Ä–æ–∫ –¥–æ –î–Ω—è –∑–∞—Ö–∏—Å–Ω–∏–∫—ñ–≤ —Ç–∞ –∑–∞—Ö–∏—Å–Ω–∏—Ü—å –£–∫—Ä–∞—ó–Ω–∏</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --sky: #bfeff7;
            /* sky background like your poster */
            --blue: #1c6fb8;
            /* ribbon blue */
            --yellow: #ffd43b;
            /* ribbon yellow */
            --coral: #f35a38;
            /* accents (–ª–∏—Å—Ç—è/–∫–æ–≤–±–∞—Å–∫–∏) */
            --dark: #1b2a4e;
        }

        body {
            background: var(--sky);
            color: #14324a;
        }

        .hero {
            background: linear-gradient(180deg, #d4f6fb 0%, var(--sky) 60%, #c9eef6 100%);
            position: relative;
            overflow: hidden;
        }

        /* wave ribbon to echo your poster */
        .ribbon svg {
            width: 100%;
            height: 80px;
            display: block;
        }

        .badge-dot {
            width: .6rem;
            height: .6rem;
            border-radius: 50%;
            display: inline-block;
        }

        .badge-blue {
            background: var(--blue);
        }

        .badge-yellow {
            background: var(--yellow);
        }

        .card {
            border-radius: 1rem;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .08);
        }

        .leaf {
            color: var(--coral);
        }

        .btn-ua {
            background: linear-gradient(90deg, var(--blue), #2382de);
            border: none;
            color: #fff;
        }

        .btn-ua:hover {
            filter: brightness(1.05);
        }

        .pill {
            background: #ffffffcc;
            border-radius: 999px;
        }

        footer a {
            color: var(--blue);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .testing-hidden {
            display: none;
        }
    </style>
</head>

<body>
    <header class="hero py-4">
        <div class="container">
            <div class="text-center mb-2 ribbon">
                <!-- UA wave ribbon -->
                <svg viewBox="0 0 1200 160" preserveAspectRatio="none" aria-hidden="true">
                    <path d="M0,80 C200,120 340,40 580,60 C800,80 950,120 1200,70 L1200,0 L0,0 Z" fill="var(--blue)">
                    </path>
                    <path d="M0,90 C220,130 360,50 590,70 C820,90 960,130 1200,80 L1200,50 L0,50 Z"
                        fill="var(--yellow)"></path>
                </svg>
            </div>
            <h1 class="display-6 fw-bold text-center">–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å!</h1>
            <p class="lead text-center mb-0">–ë–ª–∞–≥–æ–¥—ñ–π–Ω–∏–π —è—Ä–º–∞—Ä–æ–∫ –¥–æ –î–Ω—è –∑–∞—Ö–∏—Å–Ω–∏–∫—ñ–≤ —ñ –∑–∞—Ö–∏—Å–Ω–∏—Ü—å –£–∫—Ä–∞—ó–Ω–∏<br />—Ç–∞ —Å–≤—è—Ç–∞
                –ü–æ–∫—Ä–æ–≤–∏ –ü—Ä–µ—Å–≤—è—Ç–æ—ó –ë–æ–≥–æ—Ä–æ–¥–∏—Ü—ñ</p>
            <div class="text-center mt-2">
                <span class="badge-dot badge-blue me-1"></span>
                <span class="badge-dot badge-yellow me-1"></span>
                <span class="badge-dot badge-blue me-1"></span>
            </div>
        </div>
    </header>

    <main class="container my-4">
        <div class="row g-4">
            <!-- Details -->
            <section class="col-12 col-lg-7">
                <div class="card p-4">
                    <h2 class="h4 mb-3">–î–µ—Ç–∞–ª—ñ –ø–æ–¥—ñ—ó</h2>

                    <!-- EDIT THESE CONSTANTS IN JS IF NEEDED -->
                    <ul class="list-unstyled mb-4">
                        <li class="mb-2"><strong>–ö–æ–ª–∏:</strong> <span id="whenText">–°–µ—Ä–µ–¥–∞, 1 –∂–æ–≤—Ç–Ω—è, –ø–æ—á–∞—Ç–æ–∫ –æ
                                13:20</span></li>
                        <li class="mb-2"><strong>–ú—ñ—Å—Ü–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è:</strong> –ó—É–±—Ä—è–Ω—Å—å–∫–∏–π –ª—ñ—Ü–µ–π –°–æ–ª–æ–Ω–∫—ñ–≤—Å—å–∫–æ—ó —Å—ñ–ª—å—Å—å–∫–æ—ó
                            —Ä–∞–¥–∏</li>
                        <li class="mb-2"><strong>–î–ª—è –∫–æ–≥–æ:</strong> –≤—ñ–¥ –Ω–∞–π–º–µ–Ω—à–∏—Ö –¥–æ –Ω–∞–π—Å—Ç–∞—Ä—à–∏—Ö ‚Äî —è—Ä–º–∞—Ä–æ–∫ –¥–ª—è –≤—Å—ñ—î—ó
                            —Ä–æ–¥–∏–Ω–∏</li>
                    </ul>

                    <div class="pill px-3 py-2 mb-3">
                        üé† –†–æ–∑–≤–∞–≥–∏: –Ω–∞–¥—É–≤–Ω—ñ <strong>–≥—ñ—Ä–∫–∏</strong>, <strong>–±–∞—Ç—É—Ç–∏</strong>, —ñ–≥—Ä–∞—à–∫–∏, –∫–≤–µ—Å—Ç–∏
                    </div>
                    <div class="pill px-3 py-2 mb-3">
                        üé∂ <strong>–í–æ–∫–∞–ª—å–Ω—ñ –Ω–æ–º–µ—Ä–∏</strong> —Ç–∞ —Å—Ü–µ–Ω–∞
                    </div>
                    <div class="pill px-3 py-2 mb-3">
                        üé® <strong>–ê–∫–≤–∞–≥—Ä–∏–º</strong> –¥–ª—è –¥—ñ—Ç–µ–π
                    </div>
                    <div class="pill px-3 py-2">
                        üç≤ <strong>–ö—É–ª—ñ—à</strong>, üå≠ <strong>–∫–æ–≤–±–∞—Å–∫–∏</strong>, ‚òï <strong>—á–∞–π, –∫–∞–≤–∞, –∫–∞–ø—É—á–∏–Ω–æ</strong>
                        ‚Äî —Ç–∞ –±–∞–≥–∞—Ç–æ —ñ–Ω—à–æ–≥–æ
                    </div>
                </div>

                <div class="card p-4 mt-4">
                    <h3 class="h5">–î–æ–¥–∞—Ç–∏ —É –∫–∞–ª–µ–Ω–¥–∞—Ä</h3>
                    <div class="d-flex flex-wrap gap-2">
                        <a id="icsLink" class="btn btn-outline-primary" href="#"
                            download="Defender-Day-Fair.ics">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .ics</a>
                        <a id="gcalLink" class="btn btn-outline-success" target="_blank" rel="noopener">Google
                            Calendar</a>
                    </div>
                    <p class="small text-muted mt-2">–ß–∞—Å —É –ª—ñ–Ω–∫–∞—Ö —Ñ–æ—Ä–º—É—î—Ç—å—Å—è –¥–ª—è –≤–∞—à–æ–≥–æ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å—É.</p>
                </div>
            </section>

            <!-- CTA / Reminder -->
            <aside class="col-12 col-lg-5">
                <div class="card p-4 h-100">
                    <h2 class="h4 mb-3">–ù–µ –ø—Ä–æ–ø—É—Å—Ç—ñ—Ç—å –ø–æ–¥—ñ—é</h2>
                    <p class="mb-3">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ ‚Äî –º–∏ –Ω–∞–¥—ñ—à–ª–µ–º–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è <strong>–∑–∞ –¥–µ–Ω—å</strong> —ñ
                        <strong>–∑–∞ 2 –≥–æ–¥–∏–Ω–∏</strong> –¥–æ –ø–æ—á–∞—Ç–∫—É (—è–∫—â–æ —Ü–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º).
                    </p>
                    <button id="remindBtn" class="btn btn-ua btn-lg w-100">
                        üîî –ù–∞–≥–∞–¥–∞—Ç–∏ –º–µ–Ω—ñ
                    </button>
                    <div id="remindStatus" class="mt-3 small text-muted"></div>

                    <hr class="my-4" />
                    <h3 class="h6">–ü–∏—Ç–∞–Ω–Ω—è & –ø–æ—à–∏—Ä–µ–Ω—ñ –≤–∏–ø–∞–¥–∫–∏</h3>
                    <ul class="small mb-0">
                        <li>–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—é—Ç—å –∑ HTTPS (GitHub Pages ‚úÖ).</li>
                        <li>–£ Chrome/Edge (Android/Desktop) –º–æ–∂–ª–∏–≤–µ —Ñ–æ–Ω–æ–≤–µ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è. –í —ñ–Ω—à–∏—Ö ‚Äî —Ç—Ä–∏–º–∞–π—Ç–µ –≤–∫–ª–∞–¥–∫—É
                            –≤—ñ–¥–∫—Ä–∏—Ç–æ—é –∞–±–æ –¥–æ–¥–∞–π—Ç–µ –ø–æ–¥—ñ—é —É –∫–∞–ª–µ–Ω–¥–∞—Ä.</li>
                    </ul>
                </div>
            </aside>

            <!-- Testing Panel (hidden by default) -->
            <section id="testingPanel" class="col-12 testing-hidden">
                <div class="card p-4 border-warning">
                    <div class="d-flex align-items-center mb-3">
                        <h2 class="h4 mb-0 me-2">üß™ Testing Mode</h2>
                        <span class="badge bg-warning text-dark">Development Only</span>
                    </div>
                    <p class="small text-muted mb-3">Configure custom notification times for testing. Times are relative
                        to now.</p>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="testTime1" class="form-label">First notification (seconds from now)</label>
                            <input type="number" class="form-control" id="testTime1" value="10" min="1" max="3600">
                            <div class="form-text">Default: 10 seconds</div>
                        </div>
                        <div class="col-md-6">
                            <label for="testTime2" class="form-label">Second notification (seconds from now)</label>
                            <input type="number" class="form-control" id="testTime2" value="30" min="1" max="3600">
                            <div class="form-text">Default: 30 seconds</div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button id="updateTestTimes" class="btn btn-warning btn-sm">Update Test Times</button>
                        <button id="clearNotifications" class="btn btn-outline-secondary btn-sm">Clear All
                            Notifications</button>
                    </div>

                    <div id="testingStatus" class="mt-3 small"></div>
                </div>
            </section>
        </div>
    </main>

    <footer class="container pb-5">
        <div class="text-center">
            <div class="text-muted small">
                –î—è–∫—É—î–º–æ –∑–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –Ω–∞—à–∏—Ö –∑–∞—Ö–∏—Å–Ω–∏–∫—ñ–≤ üíôüíõ
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS (optional, for components) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /************ EDIT EVENT SETTINGS HERE ************/
        // Local time for the event (interpreted in the visitor's timezone)
        // Change to current year automatically if month/day passed:
        const EVENT_LOCAL_ISO = "2025-10-01T13:20:00"; // 1 Oct, 13:20
        const EVENT_DURATION_MIN = 120; // for calendar links (minutes)
        const EVENT_TITLE = "–ë–ª–∞–≥–æ–¥—ñ–π–Ω–∏–π —è—Ä–º–∞—Ä–æ–∫ –¥–æ –î–Ω—è –∑–∞—Ö–∏—Å–Ω–∏–∫—ñ–≤ —ñ –∑–∞—Ö–∏—Å–Ω–∏—Ü—å –£–∫—Ä–∞—ó–Ω–∏";
        const EVENT_LOCATION = "–ó—É–±—Ä—è–Ω—Å—å–∫–∏–π –ª—ñ—Ü–µ–π –°–æ–ª–æ–Ω–∫—ñ–≤—Å—å–∫–æ—ó —Å—ñ–ª—å—Å—å–∫–æ—ó —Ä–∞–¥–∏";
        const EVENT_DESC = "–†–æ–∑–≤–∞–≥–∏ –¥–ª—è –≤—Å—ñ—î—ó —Ä–æ–¥–∏–Ω–∏: –≥—ñ—Ä–∫–∏, –±–∞—Ç—É—Ç–∏, –≤–æ–∫–∞–ª—å–Ω—ñ –Ω–æ–º–µ—Ä–∏, –∞–∫–≤–∞–≥—Ä–∏–º, –∫—É–ª—ñ—à, –∫–æ–≤–±–∞—Å–∫–∏, –Ω–∞–ø–æ—ó —Ç–∞ –±–∞–≥–∞—Ç–æ —ñ–Ω—à–æ–≥–æ.";
        /**************************************************/

        // Check for testing mode
        const urlParams = new URLSearchParams(window.location.search);
        const TESTING_MODE = urlParams.get('testing') === 'true';

        if (TESTING_MODE) {
            console.log('üß™ Testing mode enabled');
            // Add testing indicator to page title
            document.title = '[TEST] ' + document.title;
        }

        // Normalize year (if author left old year)
        function normalizeYear(date) {
            const d = new Date(date);
            const now = new Date();
            if (d < now && d.getFullYear() < now.getFullYear()) {
                d.setFullYear(now.getFullYear());
            }
            return d;
        }
        const eventStart = normalizeYear(EVENT_LOCAL_ISO);
        const whenText = new Intl.DateTimeFormat('uk-UA', {
            weekday: 'long', day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit'
        }).format(eventStart);
        document.getElementById('whenText').textContent = whenText.charAt(0).toUpperCase() + whenText.slice(1);

        /* ---------- Calendar helpers ---------- */
        function pad(n) { return String(n).padStart(2, '0'); }
        function toGCalDate(d) {
            return d.getUTCFullYear()
                + pad(d.getUTCMonth() + 1)
                + pad(d.getUTCDate()) + "T"
                + pad(d.getUTCHours()) + pad(d.getUTCMinutes()) + "00Z";
        }
        (function setupCalendarLinks() {
            const end = new Date(eventStart.getTime() + EVENT_DURATION_MIN * 60000);
            const gcal = new URL("https://calendar.google.com/calendar/render");
            gcal.searchParams.set("action", "TEMPLATE");
            gcal.searchParams.set("text", EVENT_TITLE);
            gcal.searchParams.set("details", EVENT_DESC);
            gcal.searchParams.set("location", EVENT_LOCATION);
            gcal.searchParams.set("dates", `${toGCalDate(eventStart)}/${toGCalDate(end)}`);
            document.getElementById('gcalLink').href = gcal.toString();

            // Basic ICS
            const uid = crypto.randomUUID();
            const dtStamp = toGCalDate(new Date()).replace(/Z$/, 'Z');
            const ics =
                `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Defender Day Fair//UA Invite//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${dtStamp}
DTSTART:${toGCalDate(eventStart)}
DTEND:${toGCalDate(end)}
SUMMARY:${EVENT_TITLE}
DESCRIPTION:${EVENT_DESC}
LOCATION:${EVENT_LOCATION}
END:VEVENT
END:VCALENDAR`;
            const blob = new Blob([ics], { type: "text/calendar;charset=utf-8" });
            document.getElementById('icsLink').href = URL.createObjectURL(blob);
        })();

        /* ---------- Notifications ---------- */
        const statusEl = document.getElementById('remindStatus');
        const remindBtn = document.getElementById('remindBtn');

        // Calculate notification times based on mode
        function getNotificationTimes() {
            if (TESTING_MODE) {
                const now = new Date();
                const time1Seconds = parseInt(document.getElementById('testTime1')?.value || '10');
                const time2Seconds = parseInt(document.getElementById('testTime2')?.value || '30');
                return {
                    first: new Date(now.getTime() + time1Seconds * 1000),
                    second: new Date(now.getTime() + time2Seconds * 1000)
                };
            } else {
                return {
                    first: new Date(eventStart.getTime() - 24 * 60 * 60 * 1000),
                    second: new Date(eventStart.getTime() - 2 * 60 * 60 * 1000)
                };
            }
        }

        let { first: oneDayBefore, second: twoHoursBefore } = getNotificationTimes();

        function supportText() {
            const hasSW = 'serviceWorker' in navigator;
            const hasNotif = 'Notification' in window;
            if (!hasSW || !hasNotif) return "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤–µ–±-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è. –°–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –Ω–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä –≤–∏—â–µ.";
            return "–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è. –ö–ª—ñ–∫–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å.";
        }
        statusEl.textContent = supportText();

        async function registerSW() {
            // Use external sw.js if present; fallback to inline blob (works on GH Pages).
            try {
                // Prefer /sw.js at site root or same folder
                const reg = await navigator.serviceWorker.register('./sw.js').catch(async () => {
                    const code = `
            self.addEventListener('install', ()=>self.skipWaiting());
            self.addEventListener('activate', e=>e.waitUntil(self.clients.claim()));
            self.addEventListener('notificationclick', event => {
              event.notification.close();
              event.waitUntil(clients.openWindow('./'));
            });
          `;
                    const blob = new Blob([code], { type: 'text/javascript' });
                    const url = URL.createObjectURL(blob);
                    return navigator.serviceWorker.register(url);
                });
                return reg;
            } catch (e) {
                console.error(e);
                throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ Service Worker.");
            }
        }

        function scheduleInPageTimers() {
            // Get current notification times (may be updated in testing mode)
            const times = getNotificationTimes();
            const now = Date.now();

            const plan = TESTING_MODE ? [
                { t: times.first, tag: 'test-1', title: 'Test Notification #1', body: 'First test notification triggered!' },
                { t: times.second, tag: 'test-2', title: 'Test Notification #2', body: 'Second test notification triggered!' }
            ] : [
                { t: times.first, tag: 'fair-1d', title: '–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: —è—Ä–º–∞—Ä–æ–∫ —É–∂–µ –∑–∞–≤—Ç—Ä–∞', body: '–ü–æ—á–∞—Ç–æ–∫ –æ 13:20. –ó—É—Å—Ç—Ä—ñ–Ω–µ–º–æ—Å—å –Ω–∞ —è—Ä–º–∞—Ä–∫—É!' },
                { t: times.second, tag: 'fair-2h', title: '–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: –∑–∞ 2 –≥–æ–¥–∏–Ω–∏', body: '–°–∫–æ—Ä–æ –ø–æ—á–∞—Ç–æ–∫ ‚Äî –æ 13:20.' }
            ];

            let scheduledCount = 0;
            for (const p of plan) {
                const diff = p.t.getTime() - now;
                if (diff > 0) {
                    console.log(`Scheduling notification "${p.title}" in ${Math.round(diff / 1000)} seconds (${Math.round(diff / 1000 / 60)} minutes)`);
                    setTimeout(() => {
                        if (Notification.permission === 'granted') {
                            new Notification(p.title, {
                                body: p.body,
                                tag: p.tag,
                                icon: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23ffd43b" d="M12 2a7 7 0 0 0-7 7v3.1L3.3 14a1 1 0 0 0 .3 1.4l1.4.9V19a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-2.7l1.4-.9a1 1 0 0 0 .3-1.4L19 12.9V9a7 7 0 0 0-7-7Z"/></svg>'
                            });
                        }
                    }, diff);
                    scheduledCount++;
                } else {
                    console.log(`Skipping past notification "${p.title}"`);
                }
            }

            return scheduledCount;
        } remindBtn.addEventListener('click', async () => {
            try {
                // Update button state immediately
                remindBtn.disabled = true;
                remindBtn.textContent = "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è...";
                statusEl.textContent = "–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É —Å–ø–æ–≤—ñ—â–µ–Ω—å...";

                if (!('Notification' in window)) {
                    statusEl.textContent = "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è. –î–æ–¥–∞–π—Ç–µ –ø–æ–¥—ñ—é —É –∫–∞–ª–µ–Ω–¥–∞—Ä.";
                    return;
                }

                statusEl.textContent = "–ó–∞–ø–∏—Ç—É—î–º–æ –¥–æ–∑–≤—ñ–ª –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è...";
                const perm = await Notification.requestPermission();
                if (perm !== 'granted') {
                    statusEl.textContent = "–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ. –£–≤—ñ–º–∫–Ω—ñ—Ç—å —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –±—Ä–∞—É–∑–µ—Ä–∞ –∞–±–æ –¥–æ–¥–∞–π—Ç–µ –ø–æ–¥—ñ—é —É –∫–∞–ª–µ–Ω–¥–∞—Ä.";
                    return;
                }

                statusEl.textContent = "–†–µ—î—Å—Ç—Ä—É—î–º–æ service worker...";
                await registerSW();

                // Always use in-page timers since TimestampTrigger is not widely supported
                statusEl.textContent = "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å...";
                const scheduledCount = scheduleInPageTimers();

                if (scheduledCount === 0) {
                    statusEl.innerHTML = "‚ÑπÔ∏è –ü–æ–¥—ñ—è –≤–∂–µ –º–∏–Ω—É–ª–∞ –∞–±–æ –∑–∞–Ω–∞–¥—Ç–æ –±–ª–∏–∑—å–∫–æ. –î–æ–¥–∞–π—Ç–µ –ø–æ–¥—ñ—é —É –∫–∞–ª–µ–Ω–¥–∞—Ä –¥–ª—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è.";
                    remindBtn.textContent = "–ü–æ–¥—ñ—è –º–∏–Ω—É–ª–∞";
                    return;
                }

                // Try to schedule a test notification to verify everything works
                setTimeout(() => {
                    if (Notification.permission === 'granted') {
                        new Notification('–¢–µ—Å—Ç —Å–ø–æ–≤—ñ—â–µ–Ω—å', {
                            body: '–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—é—Ç—å! –í–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ —è—Ä–º–∞—Ä–æ–∫.',
                            tag: 'test-notification',
                            icon: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23ffd43b" d="M12 2a7 7 0 0 0-7 7v3.1L3.3 14a1 1 0 0 0 .3 1.4l1.4.9V19a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-2.7l1.4-.9a1 1 0 0 0 .3-1.4L19 12.9V9a7 7 0 0 0-7-7Z"/></svg>'
                        });
                    }
                }, 1000);

                const times = getNotificationTimes();
                statusEl.innerHTML = "‚úÖ –ì–æ—Ç–æ–≤–æ! –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ:<br/>" +
                    (TESTING_MODE ?
                        `‚Ä¢ Test notification 1: ${times.first.toLocaleString('uk-UA')} (${Math.round((times.first.getTime() - Date.now()) / 1000)}s)<br/>` +
                        `‚Ä¢ Test notification 2: ${times.second.toLocaleString('uk-UA')} (${Math.round((times.second.getTime() - Date.now()) / 1000)}s)<br/>` +
                        "<small>üß™ Testing mode active - notifications will fire soon!</small>"
                        :
                        "‚Ä¢ –ó–∞ –¥–µ–Ω—å –¥–æ –ø–æ–¥—ñ—ó: " + times.first.toLocaleString('uk-UA') + "<br/>" +
                        "‚Ä¢ –ó–∞ 2 –≥–æ–¥–∏–Ω–∏ –¥–æ –ø–æ–¥—ñ—ó: " + times.second.toLocaleString('uk-UA') + "<br/>" +
                        "<small>–ó–∞—É–≤–∞–∂–µ–Ω–Ω—è: —Ç—Ä–∏–º–∞–π—Ç–µ –≤–∫–ª–∞–¥–∫—É –≤—ñ–¥–∫—Ä–∏—Ç–æ—é –∞–±–æ –¥–æ–¥–∞–π—Ç–µ –ø–æ–¥—ñ—é —É –∫–∞–ª–µ–Ω–¥–∞—Ä –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ.</small>"
                    );

                remindBtn.textContent = "‚úÖ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ";

            } catch (err) {
                console.error('Notification setup error:', err);
                statusEl.textContent = "‚ùå –í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞: " + err.message + ". –°–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–¥–∞—Ç–∏ –ø–æ–¥—ñ—é —É –∫–∞–ª–µ–Ω–¥–∞—Ä.";
                remindBtn.disabled = false;
                remindBtn.textContent = "üîî –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑";
            }
        });

        // Testing mode initialization and controls
        if (TESTING_MODE) {
            document.addEventListener('DOMContentLoaded', () => {
                // Show testing panel
                const testingPanel = document.getElementById('testingPanel');
                if (testingPanel) {
                    testingPanel.classList.remove('testing-hidden');
                }

                // Testing controls
                const updateTestTimesBtn = document.getElementById('updateTestTimes');
                const clearNotificationsBtn = document.getElementById('clearNotifications');
                const testingStatusEl = document.getElementById('testingStatus');

                if (updateTestTimesBtn) {
                    updateTestTimesBtn.addEventListener('click', () => {
                        // Update the times variables
                        const times = getNotificationTimes();
                        oneDayBefore = times.first;
                        twoHoursBefore = times.second;

                        testingStatusEl.innerHTML = `‚è∞ Test times updated:<br/>
                            ‚Ä¢ First: ${times.first.toLocaleString('uk-UA')} (in ${Math.round((times.first.getTime() - Date.now()) / 1000)}s)<br/>
                            ‚Ä¢ Second: ${times.second.toLocaleString('uk-UA')} (in ${Math.round((times.second.getTime() - Date.now()) / 1000)}s)`;
                    });
                }

                if (clearNotificationsBtn) {
                    clearNotificationsBtn.addEventListener('click', async () => {
                        try {
                            // Clear all existing notifications
                            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                                const registrations = await navigator.serviceWorker.getRegistrations();
                                for (const registration of registrations) {
                                    const notifications = await registration.getNotifications();
                                    notifications.forEach(notification => notification.close());
                                }
                            }
                            testingStatusEl.textContent = "üßπ All notifications cleared.";
                        } catch (error) {
                            console.error('Failed to clear notifications:', error);
                            testingStatusEl.textContent = "‚ùå Failed to clear notifications.";
                        }
                    });
                }

                // Update testing status initially
                const times = getNotificationTimes();
                testingStatusEl.innerHTML = `Current test times:<br/>
                    ‚Ä¢ First: in ${Math.round((times.first.getTime() - Date.now()) / 1000)} seconds<br/>
                    ‚Ä¢ Second: in ${Math.round((times.second.getTime() - Date.now()) / 1000)} seconds`;
            });
        }
    </script>
</body>

</html>